<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>Produto - Divas</title>
  <link rel="icon" type="image/png" href="divas.png">
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: Arial, sans-serif;
      background-color: #fff;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }
    .nav-wrapper {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      background: #fff;
      z-index: 1000;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    .header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 8px 16px;
    }
    .menu-icon {
      font-size: 28px;
      cursor: pointer;
      position: relative;
    }
    .bag-icon {
      width: 56px;
      height: 56px;
      cursor: pointer;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .bag-icon img {
      width: 100%;
      height: auto;
    }
    .bag-icon .cart-count {
      position: absolute;
      top: -4px;
      right: -8px;
      background: #ff0000;
      color: #fff;
      font-size: 12px;
      padding: 2px 6px;
      border-radius: 12px;
      display: none;
    }
    .logo img {
      max-height: 80px;
      width: auto;
      cursor: pointer;
    }
    .search-container {
      display: flex;
      width: 100%;
      padding: 0 16px 16px;
    }
    .search-input {
      flex: 1;
      padding: 12px;
      border: 1px solid #ccc;
      border-radius: 8px 0 0 8px;
      outline: none;
      font-size: 16px;
      background-color: #f2f2f2;
    }
    .search-button {
      background-color: #dfb33a;
      border: none;
      padding: 0 16px;
      border-radius: 0 8px 8px 0;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
    }
    .search-button img {
      height: 36px;
      width: auto;
    }

    /* CATEGORIAS TEXTO - COM ANIMAÇÃO DE SCROLL */
    .categories-container {
      display: flex;
      gap: 16px;
      overflow-x: auto;
      scroll-behavior: smooth;
      padding: 8px 16px 16px;
      -webkit-overflow-scrolling: touch;
    }
    .categories-container.hidden {
      scrollbar-width: none;
    }
    .categories-container.hidden::-webkit-scrollbar {
      display: none;
    }
    .categories-container::-webkit-scrollbar {
      height: 6px;
      transition: all 0.3s ease;
    }
    .categories-container.hidden::-webkit-scrollbar-thumb {
      background-color: transparent;
    }
    .categories-container::-webkit-scrollbar-track {
      background: #f1f1f1;
      border-radius: 3px;
    }
    .categories-container::-webkit-scrollbar-thumb {
      background: #dfb33a;
      border-radius: 3px;
      transition: all 0.3s ease;
    }
    .category {
      cursor: pointer;
      white-space: nowrap;
      padding: 12px 0;
      font-size: 18px;
      font-weight: 500;
      text-transform: uppercase;
      color: #333;
      transition: all 0.2s;
    }
    .category:hover {
      color: #dfb33a;
    }

    /* ESTILOS DO PRODUTO */
    .main-content {
      margin-top: 220px; /* Adjusted to accommodate fixed header and potential breadcrumb */
      flex: 1;
      display: flex;
      flex-direction: column;
    }
    .produto-container {
      padding: 16px;
      min-height: 300px;
    }
    .produtos-wrapper {
      display: none; /* Hidden by default, shown when displaying product lists */
      padding: 16px;
      background-color: #f2f2f2;
      flex: 1; /* Allow it to grow and fill space */
    }
    /* Breadcrumb styles from index.html */
    #breadcrumb {
      display: none; /* Hidden by default */
      background: #fff;
      border-bottom: 1px solid #eee;
      padding: 8px 16px;
    }
    #breadcrumb .path {
      font-size: 14px;
      color: #007bff;
      cursor: pointer;
      text-decoration: underline;
    }
    #breadcrumb .separator {
      font-size: 14px;
      color: #555;
      margin: 0 8px;
    }
    #breadcrumb .crumbName {
      font-size: 14px;
      text-transform: capitalize;
    }
    .header-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 8px;
    }
    .header-row .title {
      font-weight: bold;
      font-size: 20px;
      text-transform: uppercase;
    }
    .header-row .count {
      font-size: 14px;
      color: #555;
    }

    .breadcrumb-list {
      font-size: 14px;
      color: #666;
      margin-bottom: 16px;
    }
    .breadcrumb-list a {
      color: #007bff;
      text-decoration: none;
    }
    .carousel {
      position: relative;
      margin-bottom: 16px;
    }
    .carousel img {
      width: 100%;
      height: 350px;
      object-fit: cover;
      border-radius: 8px;
    }
    .produto-nome {
      font-size: 24px;
      font-weight: bold;
      color: #333;
      margin-bottom: 8px;
    }
    .produto-preco {
      font-size: 24px;
      font-weight: bold;
      color: #000;
      margin-bottom: 8px;
    }
    .produto-extra {
      font-size: 15px;
      color: #007bff;
      margin-bottom: 16px;
    }
    .purchase-controls {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 16px;
    }
    .qty-controls {
      display: flex;
      align-items: center;
      border: 1px solid #ccc;
      border-radius: 8px;
    }
    .qty-controls button {
      background: none;
      border: none;
      font-size: 18px;
      padding: 8px 12px;
      cursor: pointer;
    }
    .qty-controls .qty {
      padding: 0 12px;
      font-size: 18px;
      min-width: 24px;
      text-align: center;
    }
    .buy-btn {
      flex: 1;
      background-color: #dfb33a;
      color: #fff;
      border: none;
      padding: 12px;
      border-radius: 8px;
      font-size: 16px;
      cursor: pointer;
    }
    .info-section {
      font-size: 14px;
      color: #555;
      margin-bottom: 4px;
    }
    .descricao {
      font-size: 14px;
      color: #333;
      margin-top: 8px;
      line-height: 1.5;
    }
    hr {
      border: none;
      border-top: 1px solid #ddd;
      margin: 16px 0;
    }
    .produtos-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 24px;
    }
    .produto {
      cursor: pointer;
    }
    .produto img {
      width: 100%;
      height: 240px;
      object-fit: cover;
      border-radius: 8px;
      margin-bottom: 12px;
    }
    .produto .nome {
      font-size: 14px;
      font-weight: bold;
      margin-bottom: 8px;
    }
    .produto .preco {
      font-size: 20px;
      font-weight: bold;
      margin-bottom: 8px;
    }
    .produto .extra {
      font-size: 13px;
      color: #007bff;
      margin-bottom: 8px;
    }
    .no-products {
      grid-column: 1 / -1;
      text-align: center;
      padding: 20px;
    }
    .category-section {
      margin-bottom: 32px; /* Space between category sections */
    }
    .category-title {
      font-size: 24px;
      font-weight: bold;
      margin: 24px 0 16px;
      text-transform: uppercase;
      cursor: pointer;
    }


    /* MENU OVERLAY */
    #overlayMenu {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: #fff;
      transform: translateX(-100%);
      transition: transform 0.3s ease;
      z-index: 2000;
      padding: 60px 20px;
      display: flex;
      flex-direction: column;
    }
    #overlayMenu.open {
      transform: translateX(0);
    }
    #overlayMenu .close-btn {
      position: absolute;
      top: 16px;
      right: 16px;
      font-size: 32px;
      cursor: pointer;
    }
    #overlayMenu nav {
      display: flex;
      flex-direction: column;
      gap: 0;
      margin-top: 20px;
    }
    #overlayMenu nav a {
      font-size: 20px;
      color: #000;
      text-decoration: none;
      text-transform: uppercase;
      padding: 8px 0;
    }

    /* FOOTER */
    .site-footer {
      background-color: #dfb33a;
      color: #fff;
      padding: 16px;
      margin-top: auto;
    }
    .site-footer .footer-item {
      margin-bottom: 12px;
      font-size: 14px;
    }
    .site-footer .footer-item.instagram {
      margin-bottom: 32px;
    }
    .site-footer .footer-item.instagram img {
      width: 20px;
      height: auto;
      display: block;
    }
    .site-footer .footer-item a {
      color: inherit;
      text-decoration: none;
    }
    .site-footer .footer-item:last-child {
      margin-bottom: 0;
    }

    @media (max-width: 480px) {
      .main-content {
        margin-top: 200px;
      }
      .carousel img {
        height: 280px;
      }
      .category {
        font-size: 16px;
        padding: 10px 0;
      }
      .categories-container {
        gap: 16px;
        padding: 8px 16px 16px;
      }
      .produtos-grid {
        grid-template-columns: 1fr 1fr;
      }
      .produto img {
        height: 220px;
      }
    }
  </style>
</head>
<body>
  <div id="overlayMenu">
    <div class="close-btn">&times;</div>
    <nav>
      <a href="index.html" id="home-link">Início</a>
      <a href="#" id="all-products-link">Produtos</a>
      <a href="contato.html">Contato</a>
    </nav>
  </div>

  <div class="nav-wrapper">
    <header class="header">
      <div class="menu-icon">&#9776;</div>
      <a href="index.html" class="logo">
        <img src="logo.webp" alt="Logo">
      </a>
      <a href="carrinho.html" class="bag-icon" id="cart-icon">
        <img src="cart.webp" alt="Carrinho de compras">
        <span class="cart-count" id="cart-count">0</span>
      </a>
    </header>
    <div class="search-container">
      <input class="search-input" type="text" placeholder="O que você está procurando?">
      <button class="search-button"><img src="lupa.webp" alt="Buscar"></button>
    </div>
    <div id="cats" class="categories-container">
      <div class="category">MORANGO DO AMOR</div>
      <div class="category">BOLOS</div>
      <div class="category">SALGADOS</div>
      <div class="category">DOCES</div>
    </div>
  </div>

  <div class="main-content">
    <!-- Breadcrumb section (initially hidden) -->
    <div id="breadcrumb">
      <span class="path">Início</span>
      <span class="separator">&gt;</span>
      <span class="crumbName"></span>
      <div class="header-row">
        <span class="title"></span>
        <span class="count"></span>
      </div>
    </div>

    <!-- Área do produto único -->
    <div class="produto-container" id="produto"></div>

    <!-- Área do grid de produtos (oculta inicialmente) -->
    <div id="produtos-wrapper" class="produtos-wrapper"></div>
  </div>

  <footer class="site-footer">
    <div class="footer-item instagram">
      <a href="https://www.instagram.com/divasbijouxshoes?igsh=MW55M2QzbTJnaGF4bg==" target="_blank" rel="noopener">
        <img src="instagramicon.png" alt="Instagram">
      </a>
    </div>
    <div class="footer-item">
      <a href="https://wa.me/5598992124926" target="_blank" rel="noopener">
        5598992124926
      </a>
    </div>
    <div class="footer-item">
      <a href="tel:+5589982124926">
        98992124926
      </a>
    </div>
    <div class="footer-item copyright">
      © Flowmize – 2025. Todos os direitos reservados.
    </div>
  </footer>

  <script>
    // ––––––––––––––––––––––––––––––––––
    // Gerenciamento de carrinho no localStorage
    const CART_KEY = 'cartItems';

    function getCartItems() {
      try {
        return JSON.parse(localStorage.getItem(CART_KEY)) || [];
      } catch {
        return [];
      }
    }

    function setCartItems(items) {
      localStorage.setItem(CART_KEY, JSON.stringify(items));
      renderCartCount();
    }

    function renderCartCount() {
      const cartCountEl = document.getElementById('cart-count');
      const totalQty = getCartItems().reduce((sum, item) => sum + (item.quantidade || 0), 0);
      cartCountEl.textContent = totalQty;
      cartCountEl.style.display = totalQty > 0 ? 'inline-block' : 'none';
    }

    document.addEventListener('DOMContentLoaded', renderCartCount);
    // ––––––––––––––––––––––––––––––––––

    // Configuração da barra de rolagem com efeito fade
    let scrollTimeout;
    let isFirstInteraction = true;

    const catsEl = document.getElementById('cats');
    if (catsEl) {
      catsEl.addEventListener('scroll', () => {
        if (isFirstInteraction) {
          isFirstInteraction = false;
          catsEl.classList.add('hidden');
        }

        catsEl.classList.remove('hidden');
        clearTimeout(scrollTimeout);
        scrollTimeout = setTimeout(() => {
          catsEl.classList.add('hidden');
        }, 1000);
      });
    }

    // OVERLAY MENU
    const overlay = document.getElementById('overlayMenu');
    document.querySelector('.menu-icon').onclick = () => overlay.classList.add('open');
    overlay.querySelector('.close-btn').onclick = () => overlay.classList.remove('open');

    // Breadcrumb elements
    const breadcrumbEl = document.getElementById('breadcrumb');
    const pathEl = breadcrumbEl.querySelector('.path');
    const crumbNameEl = breadcrumbEl.querySelector('.crumbName');
    const headerTitleEl = breadcrumbEl.querySelector('.header-row .title');
    const headerCountEl = breadcrumbEl.querySelector('.header-row .count');

    // Product display containers
    const produtoContainer = document.getElementById('produto');
    const produtosWrapper = document.getElementById('produtos-wrapper');

    // Search elements
    const searchInput = document.querySelector('.search-input');
    const searchButton = document.querySelector('.search-button');

    let allProdutos = [];
    let categorizedProducts = {};

    const categoryMap = {
      'MORANGO DO AMOR': ['morango', 'morango do amor', 'morangos'],
      'BOLOS': ['bolo', 'bolos', 'torta', 'tortas'],
      'SALGADOS': ['salgado', 'salgados', 'salgadinho', 'salgadinhos'],
      'DOCES': ['doce', 'doces', 'sobremesa', 'sobremesas']
    };

    function normalizeText(text) {
      return text
        .normalize('NFD').replace(/[\u0300-\u036f]/g, '')
        .toLowerCase()
        .trim();
    }

    function containsAnyTerm(text, terms) {
      const normalizedText = normalizeText(text);
      return terms.some(term => normalizedText.includes(term));
    }

    function filterByCategory(category) {
      const searchTerms = categoryMap[category] || [normalizeText(category)];
      return allProdutos.filter(p => {
        const nome = p.nome || '';
        return containsAnyTerm(nome, searchTerms);
      });
    }

    function categorizeProducts() {
      categorizedProducts = {
        'MORANGO DO AMOR': [],
        'BOLOS': [],
        'SALGADOS': [],
        'DOCES': []
      };

      allProdutos.forEach(product => {
        for (const [category, terms] of Object.entries(categoryMap)) {
          if (containsAnyTerm(product.nome, terms)) {
            categorizedProducts[category].push(product);
            break;
          }
        }
      });

      for (const category in categorizedProducts) {
        if (categorizedProducts[category].length === 0) {
          delete categorizedProducts[category];
        }
      }
    }

    // Function to render categorized products (like homepage in index.html)
    function renderCategorizedProducts() {
      produtosWrapper.innerHTML = '';
      produtoContainer.style.display = 'none';
      produtosWrapper.style.display = 'block';
      breadcrumbEl.style.display = 'none'; // Hide breadcrumb for this view

      for (const [category, products] of Object.entries(categorizedProducts)) {
        if (products.length === 0) continue;

        const categorySection = document.createElement('div');
        categorySection.className = 'category-section';

        const title = document.createElement('div');
        title.className = 'category-title';
        title.textContent = category;
        title.addEventListener('click', () => {
          renderProdutos(products);
          showBreadcrumb(category, products);
        });

        const grid = document.createElement('div');
        grid.className = 'produtos-grid';

        const productsToShow = products.slice(0, 4); // Show only first 4 products for homepage view

        productsToShow.forEach(p => {
          const div = document.createElement('div');
          div.className = 'produto';
          div.addEventListener('click', () => {
            const params = new URLSearchParams();
            params.set('produto', p.nome);
            params.set('imagem', encodeURIComponent(p.imagem));
            params.set('descricao', p.descricao);
            params.set('preco', p.preco);
            params.set('mensagem', p.mensagem);
            location.href = `produto.html?${params.toString()}`;
          });
          div.innerHTML = `
            <img src="${p.imagem}" alt="${p.nome}">
            <div class="nome">${p.nome}</div>
            <div class="preco">${p.preco}</div>
            ${p.mensagem ? `<div class="extra">${p.mensagem}</div>` : ''}
          `;
          grid.appendChild(div);
        });

        categorySection.appendChild(title);
        categorySection.appendChild(grid);
        produtosWrapper.appendChild(categorySection);
      }
    }

    // renderiza produto único
    function showProduto(product) {
      produtoContainer.style.display = 'block';
      produtosWrapper.style.display = 'none'; // Hide product grid

      const desc = product.descricao || '';
      const preco = (product.preco || '').replace(/[^\d.,]/g, '').replace('.', ',');
      const extra = product.mensagem || '';

      // Update breadcrumb for single product view
      showBreadcrumb(product.nome, [], true); // Pass true to indicate single product, no count

      let html = `
        <div class="carousel">
          <img src="${product.imagem || ''}" alt="${product.nome}">
        </div>
        <div class="produto-nome">${product.nome}</div>
        <div class="produto-preco">R$ ${preco}</div>
        ${extra ? `<div class="produto-extra">${extra}</div>` : ''}
      `;

      html += `
        <div class="purchase-controls">
          <div class="qty-controls">
            <button id="decrease">-</button>
            <div class="qty" id="quantity">1</div>
            <button id="increase">+</button>
          </div>
          <button class="buy-btn">COMPRAR</button>
        </div>
        <strong>Compra protegida</strong>
        <div class="info-section">Seus dados cuidados durante toda a compra.</div><hr>
        <strong>Qualidade e cuidado</strong>
        <div class="info-section">Cuidamos do seu pedido como se fosse nosso.</div><hr>
        ${desc ? `<strong>Descrição</strong><div class="descricao">${desc}</div>` : ''}
      `;

      produtoContainer.innerHTML = html;

      // Configura os controles de quantidade
      let qty = 1;
      document.getElementById('decrease').onclick = () => {
        if (qty > 1) qty--;
        document.getElementById('quantity').textContent = qty;
      };

      document.getElementById('increase').onclick = () => {
        qty++;
        document.getElementById('quantity').textContent = qty;
      };

      // Configura o botão de compra
      document.querySelector('.buy-btn').onclick = () => {
        // 1. Captura dados do produto
        const nome = product.nome;
        const precoText = document.querySelector('.produto-preco').textContent.replace('R$ ', '');
        const quantidade = parseInt(document.getElementById('quantity').textContent, 10);

        // 2. Adiciona/atualiza item no carrinho
        const items = getCartItems();
        const existente = items.find(i => i.nome === nome);

        if (existente) {
          existente.quantidade += quantidade;
        } else {
          items.push({
            nome,
            preco: precoText,
            quantidade,
            imagem: product.imagem
          });
        }

        setCartItems(items);

        // 3. Feedback visual
        const btn = document.querySelector('.buy-btn');
        btn.textContent = '✓ ADICIONADO';
        btn.style.backgroundColor = '#4CAF50';

        setTimeout(() => {
          btn.textContent = 'COMPRAR';
          btn.style.backgroundColor = '#dfb33a';
        }, 2000);
      };
    }

    // renderiza lista de produtos (grid)
    function renderProdutos(list) {
      produtoContainer.style.display = 'none'; // Hide single product view
      produtosWrapper.style.display = 'block'; // Show product grid

      const validProducts = list.filter(p => p.nome && p.imagem);

      if (validProducts.length === 0) {
        produtosWrapper.innerHTML = '<div class="no-products">Nenhum produto encontrado</div>';
        return;
      }

      const grid = document.createElement('div');
      grid.className = 'produtos-grid';

      validProducts.forEach(p => {
        const div = document.createElement('div');
        div.className = 'produto';
        div.addEventListener('click', () => {
          const params = new URLSearchParams();
          params.set('produto', p.nome);
          params.set('imagem', encodeURIComponent(p.imagem));
          params.set('descricao', p.descricao);
          params.set('preco', p.preco);
          params.set('mensagem', p.mensagem);
          location.href = `produto.html?${params.toString()}`;
        });
        div.innerHTML = `
          <img src="${p.imagem}" alt="${p.nome}">
          <div class="nome">${p.nome}</div>
          <div class="preco">${p.preco}</div>
          ${p.mensagem ? `<div class="extra">${p.mensagem}</div>` : ''}
        `;
        grid.appendChild(div);
      });

      produtosWrapper.innerHTML = '';
      produtosWrapper.appendChild(grid);
    }

    // Function to show/update the breadcrumb
    function showBreadcrumb(name, list, isSingleProduct = false) {
      pathEl.textContent = 'Início';
      crumbNameEl.textContent = name;
      headerTitleEl.textContent = name.toUpperCase();

      if (isSingleProduct) {
        headerCountEl.textContent = ''; // No count for single product
      } else {
        const validProducts = list.filter(p => p.nome && p.imagem);
        headerCountEl.textContent = `${validProducts.length} produto${validProducts.length !== 1 ? 's' : ''}`;
      }

      breadcrumbEl.style.display = 'block';
    }

    // Function to reset to the "home" view (categorized products)
    function resetToHomePage() {
      breadcrumbEl.style.display = 'none'; // Hide breadcrumb
      produtoContainer.style.display = 'none'; // Hide single product view
      produtosWrapper.style.display = 'block'; // Ensure product wrapper is visible
      renderCategorizedProducts(); // Show categorized products
    }

    // Carrega os produtos da planilha
    fetch('https://docs.google.com/spreadsheets/d/e/2PACX-1vTE8rKLWsyjrRSL1c1oUon_GxajT7HRwe_QSBCGLd2ja_qStMfDHeHYAklKsnpxo186cmPPKrh4wZFX/pub?output=csv')
      .then(r => r.text())
      .then(csv => {
        const lines = csv.split('\n').slice(1);

        // popula allProdutos
        lines.forEach(line => {
          const c = line.split(',');
          // Ensure product name and image are present and stock is not 0
          if (!c[2]?.trim() || !c[3]?.trim() || c[7]?.trim() === '0') return;

          const product = {
            nome: c[2].trim(),
            imagem: c[3]?.trim() || '',
            descricao: c[4]?.trim() || '', // Use correct column for description
            preco: c[5]?.trim() || '',     // Use correct column for price
            mensagem: c[6]?.trim() || ''   // Use correct column for message
          };

          allProdutos.push(product);
        });

        categorizeProducts();

        // If no specific product is requested via URL, show categorized products by default
        const params = new URLSearchParams(window.location.search);
        const nomeProduto = decodeURIComponent(params.get('produto') || '');

        if (nomeProduto) {
          // Find the product in allProdutos to get full details (if available)
          const productFromData = allProdutos.find(p => normalizeText(p.nome) === normalizeText(nomeProduto));
          if (productFromData) {
            showProduto(productFromData);
          } else {
            // Fallback if product not found in data, use URL params
            showProduto({
              nome: nomeProduto,
              imagem: params.get('imagem') ? decodeURIComponent(params.get('imagem')) : '',
              descricao: params.get('descricao') ? decodeURIComponent(params.get('descricao')) : '',
              preco: params.get('preco') ? decodeURIComponent(params.get('preco')) : '',
              mensagem: params.get('mensagem') ? decodeURIComponent(params.get('mensagem')) : ''
            });
          }
        } else {
          resetToHomePage(); // Show categorized products if no specific product URL
        }
      })
      .catch(error => {
        console.error('Erro ao carregar produtos:', error);
        produtosWrapper.innerHTML = '<div class="no-products">Erro ao carregar produtos. Por favor, tente novamente mais tarde.</div>';
        produtosWrapper.style.display = 'block';
        produtoContainer.style.display = 'none';
      });


    // Event Listeners for navigation and search
    document.getElementById('home-link').addEventListener('click', function(e) {
      e.preventDefault();
      resetToHomePage();
      overlay.classList.remove('open');
    });

    document.querySelector('.logo img').addEventListener('click', resetToHomePage);
    pathEl.addEventListener('click', resetToHomePage); // Click on "Início" in breadcrumb

    document.querySelectorAll('.category').forEach(el => {
      el.addEventListener('click', () => {
        const name = el.textContent.trim();
        const filtered = filterByCategory(name);
        renderProdutos(filtered);
        showBreadcrumb(name, filtered);
      });
    });

    searchInput.addEventListener('input', () => {
      const term = searchInput.value.trim();
      if (!term) {
        resetToHomePage(); // If search input is empty, go back to home view
        return;
      }

      const normalizedTerm = normalizeText(term);
      const filtered = allProdutos.filter(p => {
        const nome = normalizeText(p.nome || '');
        return nome.includes(normalizedTerm);
      });

      renderProdutos(filtered);
      showBreadcrumb(term, filtered);
    });

    searchButton.addEventListener('click', () => {
      const term = searchInput.value.trim();
      if (!term) {
        resetToHomePage(); // If search button clicked with empty input, go back to home view
        return;
      }

      const normalizedTerm = normalizeText(term);
      const filtered = allProdutos.filter(p => {
        const nome = normalizeText(p.nome || '');
        return nome.includes(normalizedTerm);
      });

      renderProdutos(filtered);
      showBreadcrumb(term, filtered);
    });

    document.getElementById('all-products-link').addEventListener('click', function(e) {
      e.preventDefault();
      overlay.classList.remove('open');
      renderProdutos(allProdutos);
      showBreadcrumb('Todos os Produtos', allProdutos);
    });

    // Update cart count when tab visibility changes
    document.addEventListener('visibilitychange', () => {
      if (!document.hidden) renderCartCount();
    });
  </script>
</body>
</html>
